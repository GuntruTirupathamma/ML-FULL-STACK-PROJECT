name: DevSecOps Code Scan

on:
  push:
  pull_request:

jobs:
  code-scan:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout source code
      - name: Checkout code
        uses: actions/checkout@v4

      # 2️⃣ Setup Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      # 3️⃣ Install security tools
      - name: Install security tools
        run: |
          python -m pip install --upgrade pip
          pip install bandit trufflehog pip-audit

      # 4️⃣ Dependency vulnerability scan (VERY IMPORTANT)
      - name: Run Dependency Scan (pip-audit)
        run: pip-audit || true

      # 5️⃣ SAST – Bandit (ML-safe configuration)
      - name: Run Bandit (SAST)
        run: |
          bandit -r . \
          -ll \
          -s B403,B301

      # 6️⃣ Secrets scanning
      - name: Run TruffleHog (Secrets Scan)
        run: trufflehog filesystem . --no-update --fail


