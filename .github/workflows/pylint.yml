name: DevSecOps Code Scan Pipeline

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  code-scan:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout code
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Set up Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      # 3. Install security tools
      - name: Install security tools
        run: |
          python -m pip install --upgrade pip
          pip install bandit pre-commit black flake8 tartufo
          pip install trufflehog==2.0.99  # latest PyPI version

      # 4. Run pre-commit hooks (code formatting & security)
      - name: Run pre-commit hooks
        run: pre-commit run --all-files

      # 5. Run Bandit (SAST)
      - name: Run Bandit (Python Security Scan)
        run: bandit -r .

      # 6. Run TruffleHog (Secrets Scan)
      - name: Run TruffleHog (Secrets Scan)
        run: trufflehog filesystem --entropy=True --regex --repo_path .

      # 7. Run Tartufo (Additional secret scan)
      - name: Run Tartufo
        run: tartufo scan




